## 2021

### 9/26

#### 完成

- 修改境界系统技术方案(6h)
- 修改不能发包的 bug (0.25h)

### 9/27

#### 完成

- 完成了提示文本和信息框(2h)
- 完成了「透明度」缓动函数和挂机系统的提示(2h)

- 开完了境界系统技术方案考察会(0.5h)

- 完成了境界系统的部分框架搭建(1h)
- 完成了境界系统 `manager.lua` ，添加了玩家上线和下线的流程(1h)
- 完成了境界系统 `data.lua` ，添加对存储数据修改的方法(1h)
- 完成了境界系统 `action` 模块的一部分，添加了 `normal_action.lua`，完成了人物属性检测和功夫等级检测(1h)

### 9/28

#### 完成

- 封装了注册 npc 对话的接口(2h)

- 完善了 `normal_action.lua` 「普通境界提升」的流程(1h)

- 添加了提示境界后的流程(1h)
- 查找并且修复 NPC 对话系统的 bug (2h)

### 9/29

#### 完成

- 定义了「打通任督二脉」的流程(2h)

- 补充完成了「打通任督二脉」的大体流程(3h)

- 优化了缓动函数，从逻辑帧控制改为渲染帧控制，动画丝滑很多(2h)

- 修复了缓动函数回调被多次调用的bug(3h)

    > 原因是逻辑帧与渲染帧组合使用，渲染帧跑完时，逻辑帧还没跑完，导致回调在每隔渲染帧调用一直到逻辑帧跑完。

- 给功夫系统的UI添加了众多动画(2h)

#### 踩坑

- lua 的外部局部变量

    lua 中每一个函数引用的外部局部变量 [upvalue] ，会被放进数组和函数的原型引用保存。这里要注意，所有的外部局部变量保存的是引用！！！包括基本类型（int、string），使用的时候切记！！！

### 9/30

#### 完成

- 写完了 entity.doMove() 接口(1h)
- 与美术讨论动画的问题(1h)
- 开会(1h)
- 读 DoTween 源码（5h)

### 10/8

#### 完成

- 完成了境界系统的头顶UI(2h)
- 完成了浮空打坐(0.5h)

- 完成了缓动系统大概框架(8h)

    > 缓动的生命周期、缓动的控制参数、缓动系统与引擎对接

### 10/9

#### 完成

- 缓动系统的 next 操作(2h)
- 缓动系统的流程(6h)
- 缓动系统的生命周期接口(2h)

### 10/11

#### 完成

- 完善缓动系统第一版剩下的内容(6h)
- 查看背包系统文档(2h)
- 修复BUG(2h)

### 10/12

#### 完成

- 修复了缓动系统的 Bug (2h)
- 写了缓动系统的使用手册和 API参考文档(2h)

- 开会(1h)

- 修复了功夫系统装备面板，按钮文字显示错粗的Bug(0.5h)
- 添加了遗忘功夫时，小于100级时不返回潜能(0.5h)
- 思考解析功夫的描述字符串的问题(1h)

#### 问题

- ~~技能的描述解析是放在技能系统还是功夫系统？~~
- Tween 封装的 `do` 系列方法，是放在作用实例上还是放在全局单例上？

### 10/13

#### 完成

- 思考功夫描述字符串是怎么样的格式(1h)

- 完成了功夫解析字符串的大体流程(2h)
- 与张政探讨关于技能的解析(1h)
- 查看背包系统文档、以及查看引擎背包系统源码(4h)

#### 问题

- 背包系统的「仓库」，所有角色共享数据，怎么解决？

    > 询问志龙

### 10/14

#### 完成

看了一天的引擎背包源码，并且觉得大部分地方的优化空间都很大。(10h)

#### 问题

- ~~引擎背包系统背包中存储的数据为 ItemData 类，但是它似乎把 **配置** 和 **数量** 放在一起了？~~

- 一些糟糕的代码...

    > server/item_data.lua : 31行 seri() 接口内的两段序列化代码高度重复。

- server/item_data.lua 文件中的「self.var」、「self._item_values」代表什么？

- 添加物品的时候，如果检测到添加物品的实体是玩家，还会调用 entity:addTarget() ，addTarget有什么用？

- 添加物品的逻辑是，遍历背包中的物品格子，如果检测到 **空格子** 或 **未满的同类型的格子**，就加入，这样做会有 bug？

- ~~添加物品的第二层接口（server/entity_tary.lua），调用了一个传进来 proc 方法，用处？~~

    > ~~用处是创建完物品后会用物品数据调用这个方法，相当于一个回调函数。~~
    >
    > 似乎不只是用作回调函数，除了回调，也被当作某种处理函数来使用？混乱。

- server/item_data.lua 中的 _block_id 有什么用？

- 引擎背包系统添加流程是：遍历背包的格子，而且每次添加前会先模拟一遍添加，然后如果模拟可以成功，就再走一遍流程来添加。这纯粹是偷懒行为。这样做的坏处：

    - 要检测背包能不能添加一个物品，最坏的情况，如果这个背包是满的，我要遍历完背包才能知道能不能添加。
    - 当一个背包内的物品格数量变得很大，每一次添加物品都是一次暴力枚举，很消耗性能。
    - 如果我想添加100个物品，如果只能装99个，那就装99个，剩下一个再做特殊处理，这样的需求怎么实现。

- 引擎背包系统减少物品时，需要减少的物品数量已经足够了，却依旧把剩下的格子遍历完了？？忘记补 break 退出循环了吗? server/entity_tray.lua : 422行。

- 减少物品的流程：遍历所有格子，找到装载了指定物品的格子，然后在这些格子里减少一直到数量足够，偷懒行为：

    - 如果物品格的数量很多，我哪怕只减少一个物品也要把所有背包遍历完。

- common/tary_class_base.lua，cleanArrEmptyChild() 方法，这个方法的作用是整理背包内的数据，思路：从背包的最后一位开始遍历，如果当前遍历的格子有物品，将物品取出，然后从背包的上一次整理位置开始遍历，一直找到空格子然后放进去。

    > 时间复杂度：o(n) 的平方 或 o(n * log n)，我不太确定。但是这样有个坏处，那就是每一次整理，越靠后的物体反而去到了靠前的空格子里。
    >
    > 该算法也有优化的空间，可以优化成 o(n) 的时间复杂度。

### 10/15

#### 完成

写了一整天的背包系统文档(10h)

### 10/18

#### 完成

写背包系统解决方案(8h)。

### 10/19

#### 完成

写背包系统解决方案(4h)。

写了一部分「仓库插件」(2h)。

修复了功夫UI 「学习」面板显示在「装备」面板前面的问题(0.25h)

调整了功夫打坐修炼特效的位置(0.25h)

### 10/20

#### 完成

思考背包系统的最佳方案(3h)

拼接新UI(5h)

### 10/21

#### 完成

修复了功夫不能读取数据的bug。(0.5h)

更换了修炼面板的新UI(1h)。

更换了装备面板的新UI(4h)。

排期，对之后的工作进行工期估算(1h)。

更换了「遗忘」面板的新UI(4h)。

### 10/22

#### 完成

修复了从「学习面板」打开「装备面板」出现报错的情况。

更换了「挂机中」的UI面板(2h)。

更换了「挂机信息」的UI面板(2h)。

尝试写UI的自动适配（失败了）(2h)。

### 10/26

#### 完成

- 修复Bug
    - 修复了可以同时修炼多个功夫的bug。(2.5h)
    - 修复了修炼完成后「挂机提示」窗口没有自动关闭的bug。(0.25h)
    - 修复了UI显示没有被父物体裁剪的bug。(1分钟)
    - 修复了挂机剩余时间计算错误的bug(0.5h)
    - 修复了不能播放特效的bug(0.5h)
    - 修复了功夫修炼到满级继续修炼会出现异常情况的bug(2h)
    - 修复了功夫「学习」面板显示异常问题(1h)
    - 修复了卸下功夫时，人物属性没有改变的bug。(1h)
    - 修复了打坐时切换到修炼依旧在播放特效的问题(0.1h)
- 新需求

    - 哪怕血量满了，也先打坐一次，然后在告诉玩家你不能打坐了，因为你血量满了。

#### 问题

- 部分时候 onShown 没有被调用
- 解决修炼太极内功时，doPractice 事件被调用两次的问题。

### 10/27

#### 完成

- 修复bug
    - 修复了点击打坐后再点击修炼特效一直播放的问题(1.5h)。
    - 添加了境界系统的访问当前境界的接口(0.1h)
    - 尝试修复从修炼内功切换至打坐动作不播放的问题，最后发现可能是引擎问题(2h)
    
- <font color = red>发呆...（1.5h)</font>

- 设置了一个项目的软链接。（0.5h)

    > 使用 windows 自带的 `mklink` 命令，结果带空格的路径需要加双引号。

- 完成了一部分 Inventory 类 和 Group 类(2h)

- 尝试给引擎的 window 添加scale扩展，失败了(3h)

    > 原因是无法拿到 window 的 getSize 方法字段。

### 10/28

#### 完成

- 完成了剩余部分的 Inventory 和 Group 类(5h)
- 写完了一部分的 InventoryMgr 仓库管理者(4h)

### 10/29

#### 完成

- 修复了蓝量或血量未满 但是体力值上限满了 然后不能打坐的bug；(0.1h)
- 改变了打坐回血的机制为百分比回血；(0.1h)
- 修复了学习面板 修炼中的功夫不显示修炼中 的bug；(0.1h)
- ...忘记写了

### 11/1

#### 完成

- 测试「仓库」插件，确保没问题。(6h)

- 做了部分UI按钮点击动画(2h)

### 11/2

#### 完成

- 测试「仓库」插件完成。(6h)
- 思考物品那块的框架和调用流程。(2h)

### 11/3

#### 完成

- 修复了挂机频繁跳秒的问题(2h)（但是还是有概率跳秒...)
- 思考了物品的使用流程(1h)
- 修改功夫系统支持实体配置，失败了....(3h)



... 



### 11/7

#### 完成

- 给背包系统添加方便调用的接口(2h)

- 给部分UI按钮添加反馈动画(2h)

- 物品使用次数限制(2h)
- 数据保存(3h)
- 背包操作同步(2h)

### 11/8

#### 完成

- 完成了使用物品和装备物品的流程(2h)

- 研究怎么使用UI滑动事件(4h)

- 修复了主动技能不显示的bug(0.5h)

    

### 11/9

#### 完成

- 研究了lua **在函数里创建函数** 的机制。并得出结论：（1h + 0.5h)

- 完全修改了计算获得经验的方式(3h)
- 修复了背包系统读取和保存数据会卡死的bug(1h)

- 修复了每次上下线功夫会自动涨经验的bug(0.5h)

